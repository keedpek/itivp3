import React, { useEffect, useState } from 'react';
import style from './StoryPage.module.css'
import Header from '../../components/Header/Header';
import Footer from '../../components/Footer/Footer';
import { useNavigate, useParams } from 'react-router-dom';
import { storiesList } from '../../utils/db';
import Dropdown from '../../components/Dropdown/Dropdown';

const StoryPage = () => {
  const { id } = useParams()
  const navigate = useNavigate()
  const [story, setStory] = useState({})
  const [isFavorite, setIsFavorite] = useState(false)
  let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
  
  useEffect(() => {
    const fetchedStory = storiesList.find(story => story.href === id)
    if(fetchedStory) {
      setStory(fetchedStory)
      setIsFavorite(favorites.includes(fetchedStory.href))
    } else {
      navigate("/404")
    }
  }, [id])

  
  const addToFavorites = () => {
    if (!favorites.includes(story.href)) {
      favorites.push(story.href);
      localStorage.setItem("favorites", JSON.stringify(favorites));
      setIsFavorite(true)
      alert("–ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!");
    } else {
      alert("–ò—Å—Ç–æ—Ä–∏—è —É–∂–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º!");
    }
  };

  const removeFromFavorites = () => {
    if (favorites.includes(story.href)) {
      console.log(story.href);
      console.log(favorites);
      favorites = favorites.filter(favStory => favStory !== story.href);
      console.log(favorites);
      localStorage.setItem("favorites", JSON.stringify(favorites));
      setIsFavorite(false)
      alert("–ò—Å—Ç–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ!");
    } else {
      alert("–ò—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º!");
    }
  };

  const copyLinkToClipboard = () => {
    const currentUrl = window.location.href;
    navigator.clipboard.writeText(currentUrl).then(() => {
      alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
    });
  };

  const openMap = () => {
    const googleMapsUrl = `https://www.google.com/maps?q=${encodeURIComponent(
      story.place
    )}`;
    window.open(googleMapsUrl, "_blank");
  };

  const dropdownOptions = {
    favorites: {
      option: isFavorite ? "–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" : "–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ",
      action: isFavorite ? removeFromFavorites : addToFavorites,
    }, 
    copyLinkToClipboard:  {
      option: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é",
      action: copyLinkToClipboard
    },
    openMap:  {
      option: "–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ",
      action: openMap
    },
  }

  return (
    <>
    <Header/>
    <main>
      <section className={style["storiey-page-main-section"]}>
        <img src={story.photo} className={style["story-image"]} alt='storyImg'/>
        <div className={style["story-title"]}>
          <h2>
            {story.title}
          </h2>
        </div>
      </section>

      <article className={style["story"]}>
        <div className={style["meta"]}>
          <h4>{story.place}</h4>
          <div className={style["right-side"]}>
            <span>{story.time}</span>
            <Dropdown options={dropdownOptions} />
          </div>
        </div>
        <h3>–ì–¥–µ –º–æ—Ä–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å –∏—Å—Ç–æ—Ä–∏–µ–π</h3>
        <p>–•–æ—Ä–≤–∞—Ç–∏—è ‚Äî —Å—Ç—Ä–∞–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –∫–∞–∂–µ—Ç—Å—è –≤—ã—Ä–≤–∞–Ω–Ω–æ–π –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü —Ñ—ç–Ω—Ç–µ–∑–∏–π–Ω–æ–≥–æ —Ä–æ–º–∞–Ω–∞. –ó–¥–µ—Å—å –∫–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥–æ–∫ —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é, –∞ –ø—Ä–∏—Ä–æ–¥–∞ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –∫—Ä–∞—Å–∏–≤–∞, —á—Ç–æ –ø–æ—Ä–æ–π —Ç—Ä—É–¥–Ω–æ –ø–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –Ω–µ –¥–µ–∫–æ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∫–æ–≥–æ-–Ω–∏–±—É–¥—å —Ñ–∏–ª—å–º–∞. –ú–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ —ç—Ç–æ–π —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–µ –Ω–∞—á–∞–ª–æ—Å—å —Å –æ—â—É—â–µ–Ω–∏—è, –±—É–¥—Ç–æ —è –ø–æ–ø–∞–ª –≤ –¥—Ä—É–≥—É—é —ç–ø–æ—Ö—É.</p>
        <h4>–î—É–±—Ä–æ–≤–Ω–∏–∫: –∂–µ–º—á—É–∂–∏–Ω–∞ –ê–¥—Ä–∏–∞—Ç–∏–∫–∏</h4>
        <p>–ü–µ—Ä–≤—ã–º –ø—É–Ω–∫—Ç–æ–º –Ω–∞—à–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ —Å—Ç–∞–ª –î—É–±—Ä–æ–≤–Ω–∏–∫ ‚Äî –≥–æ—Ä–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–Ω–æ–≥–∏–µ –∑–Ω–∞—é—Ç –ø–æ —Å–µ—Ä–∏–∞–ª—É "–ò–≥—Ä–∞ –ø—Ä–µ—Å—Ç–æ–ª–æ–≤". –£–∂–µ –ø—Ä–∏ –ø–æ–¥—ä–µ–∑–¥–µ –∫ –Ω–µ–º—É —Ç—ã –≤–∏–¥–∏—à—å –≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã, –æ–∫—Ä—É–∂—ë–Ω–Ω—ã–µ –≥–æ–ª—É–±—ã–º–∏ –≤–æ–¥–∞–º–∏ –ê–¥—Ä–∏–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ—Ä—è. –°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥ –ø–æ—Ä–∞–∂–∞–µ—Ç —Å–≤–æ–∏–º —É—Ö–æ–∂–µ–Ω–Ω—ã–º –≤–∏–¥–æ–º: –±–µ–ª—ã–µ –∫–∞–º–µ–Ω–Ω—ã–µ –¥–æ–º–∞, –º–æ—â—ë–Ω—ã–µ —É–ª–∏—Ü—ã –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–ª–æ—â–∞–¥–∏, –≥–¥–µ –≤—Ä–µ–º—è —Å–ª–æ–≤–Ω–æ –∑–∞—Å—Ç—ã–ª–æ. –Ø –ø—Ä–æ–≥—É–ª—è–ª—Å—è –ø–æ –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–º —Å—Ç–µ–Ω–∞–º –≥–æ—Ä–æ–¥–∞, –æ—Ç–∫—É–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –≤–∏–¥ –Ω–∞ –º–æ—Ä–µ –∏ –∫—Ä—ã—à–∏ –¥–æ–º–æ–≤. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±—è —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–º —Ä—ã—Ü–∞—Ä–µ–º –∏–ª–∏, –µ—Å–ª–∏ –≤—ã –ø–æ–∫–ª–æ–Ω–Ω–∏–∫ "–ò–≥—Ä—ã –ø—Ä–µ—Å—Ç–æ–ª–æ–≤", —Ç–æ –∫–æ—Ä–æ–ª—ë–º –†–æ–±–µ—Ä—Ç–æ–º –ë–∞—Ä–∞—Ç–µ–æ–Ω–æ–º. –û—Å–æ–±–µ–Ω–Ω–æ –∑–∞–ø–æ–º–Ω–∏–ª–∞—Å—å –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π –õ–∞–ø–∞–¥, –≥–¥–µ –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ—Å—Ç–æ —Å–∏–¥–µ—Ç—å –∏ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∑–∞–∫–∞—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –æ–∫—Ä–∞—à–∏–≤–∞–ª –Ω–µ–±–æ –≤ —Ä–æ–∑–æ–≤—ã–µ –∏ –∑–æ–ª–æ—Ç–∏—Å—Ç—ã–µ —Ç–æ–Ω–∞.</p>
        <h4>–ó–∞–≥—Ä–µ–±: —Å–µ—Ä–¥—Ü–µ —Å—Ç—Ä–∞–Ω—ã</h4>
        <p>–°–ª–µ–¥—É—é—â–∏–º —ç—Ç–∞–ø–æ–º —Å—Ç–∞–ª–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ —Å—Ç–æ–ª–∏—Ü—É –•–æ—Ä–≤–∞—Ç–∏–∏ ‚Äî –ó–∞–≥—Ä–µ–±. –≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–∏–º–æ—Ä—Å–∫–∏—Ö –∫—É—Ä–æ—Ä—Ç–æ–≤. –û–Ω –±–æ–ª—å—à–µ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –µ–≤—Ä–æ–ø–µ–π—Å–∫–∏–π –≥–æ—Ä–æ–¥ —Å –±–æ–≥–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –∫—É–ª—å—Ç—É—Ä–æ–π. –í –í–µ—Ä—Ö–Ω–µ–º –≥–æ—Ä–æ–¥–µ (Gornji Grad) —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å —Å—Ç–∞—Ä–∏–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è, —Ü–µ—Ä–∫–≤–∏ –∏ –∑–∞–º–∫–∏. –ú—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥–Ω—è–ª–∏—Å—å –Ω–∞ –±–∞—à–Ω—é Lotr≈°ƒçak, —á—Ç–æ–±—ã –ø–æ–ª—é–±–æ–≤–∞—Ç—å—Å—è –≤–∏–¥–æ–º –Ω–∞ –≤–µ—Å—å –≥–æ—Ä–æ–¥. –û–¥–Ω–∏–º –∏–∑ —Å–∞–º—ã—Ö –Ω–µ–æ–±—ã—á–Ω—ã—Ö –º–µ—Å—Ç –≤ –ó–∞–≥—Ä–µ–±–µ —è–≤–ª—è–µ—Ç—Å—è –ú—É–∑–µ–π —Ä–∞–∑–±–∏—Ç—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –≠—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ —Å–æ–±—Ä–∞–Ω—ã –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏—è–º–∏ –ª—é–¥–µ–π —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞. –•–æ—Ç—è —Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≥—Ä—É—Å—Ç–Ω–æ–π, —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è –ø–æ–¥–∞–Ω–∞ —Ç–∞–∫, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∫–æ—Ä–µ–µ —É–ª—ã–±–∫—É –∏ –∑–∞–¥—É–º—á–∏–≤–æ—Å—Ç—å.</p>
        <h4>–í–æ–ª—à–µ–±—Å—Ç–≤–æ –ø—Ä–∏—Ä–æ–¥—ã</h4>
        <p>–í–µ—á–µ—Ä–∞–º–∏ –º—ã —Å–∏–¥–µ–ª–∏ –≤ —É—é—Ç–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω—á–∏–∫–∞—Ö, –¥–µ–≥—É—Å—Ç–∏—Ä—É—è –º–µ—Å—Ç–Ω—ã–µ –±–ª—é–¥–∞, —Ç–∞–∫–∏–µ –∫–∞–∫ —á–µ—Ä–Ω–∏–ª–∞ –∫–∞—Ä–∞–∫–∞—Ç–∏—Ü—ã –∏–ª–∏ –æ—Å—å–º–∏–Ω–æ–≥–∏, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –≥—Ä–∏–ª–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–∞–∫–∂–µ –º–µ—Å—Ç–Ω–æ–µ –≤–∏–Ω–æ ‚Äî –æ–Ω–æ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ –¥–æ–ø–æ–ª–Ω—è–µ—Ç –≤–∫—É—Å –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–æ–≤.</p>
        <h4>–ó–∞–∫–ª—é—á–µ–Ω–∏–µ</h4>
        <p>–•–æ—Ä–≤–∞—Ç–∏—è ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞–Ω–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–≤: –æ—Ç –¥—Ä–µ–≤–Ω–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ –¥–æ –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã—Ö –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö –∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫–æ–≤, –æ—Ç —à—É–º–Ω—ã—Ö —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç –¥–æ —Å–ø–æ–∫–æ–π–Ω—ã—Ö —Ä—ã–±–∞—Ü–∫–∏—Ö –¥–µ—Ä–µ–≤—É—à–µ–∫. –û–Ω–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —á—Ç–æ-—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞, –±—É–¥—å —Ç–æ –ª—é–±–∏—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞, —Ü–µ–Ω–∏—Ç–µ–ª—å –∫—É–ª—å—Ç—É—Ä—ã –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —á–µ–ª–æ–≤–µ–∫, –∏—â—É—â–∏–π —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏—è. –ï—Å–ª–∏ –≤—ã –µ—â—ë –Ω–µ –±—ã–ª–∏ –≤ –•–æ—Ä–≤–∞—Ç–∏–∏, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ —Å–≤–æ–π —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π. –Ø —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –æ—Å—Ç–∞–≤–∏—Ç —Å–ª–µ–¥ –≤ –≤–∞—à–µ–º —Å–µ—Ä–¥—Ü–µ —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –æ–Ω–∞ –æ—Å—Ç–∞–≤–∏–ª–∞ –µ–≥–æ –≤ –º–æ—ë–º.</p>
        <h4>–ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞</h4>
        <div id="map"></div>
        <div className={style["comments"]}>
          <h2>3 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</h2>
          <input
            className={style["comment-input"]}
            placeholder="–û—Å—Ç–∞–≤—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
            type="text"
            maxlength="255"
          />
          <div className={style["comment-btns"]}>
            <button className={`${style["comment-btn"]} ${style["cansel"]}`}>–û—Ç–º–µ–Ω–∏—Ç—å</button>
            <button className={`${style["comment-btn"]} ${style["leave"]}`}>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
          </div>
          <div className={style["comments-section"]}>
            <div className={style["comment-component"]}>
              <div className={style["comment-heading"]}>
                <h3 className={style["nickname"]}>rodlox483</h3>
                <span className={style["date"]}>3 –¥–Ω—è –Ω–∞–∑–∞–¥</span>
              </div>
              <p className={style["comment"]}>–û—á –∫—Ä–∞—Å–∏–≤–æ üòç</p>
            </div>
            <div className={style["comment-component"]}>
              <div className={style["comment-heading"]}>
                <h3 className={style["nickname"]}>–í–∏–∫—Ç–æ—Ä–•–∞—Ä—á–µ–Ω–∫–æ-–∏7–∂</h3>
                <span className={style["date"]}>1 –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥</span>
              </div>
              <p className={style["comment"]}>–•–æ—Ä–≤–∞—Ç–∏—è —Å—É–ø–µ—Ä —á–∞—Å—Ç–æ –µ–∑–¥–∏–º —Ç—É–¥–∞</p>
            </div>
            <div className={style["comment-component"]}>
              <div className={style["comment-heading"]}>
                <h3 className={style["nickname"]}>Sussi861</h3>
                <span className={style["date"]}>3 –º–µ—Å—è—Ü–∞ –Ω–∞–∑–∞–¥</span>
              </div>
              <p className={style["comment"]}>–î–∞–∂–µ –±—ã —Å —Ç–∞–∫–æ–π –∫–∞—Ä—Ç–æ–π —è –±—ã —è—Ö—Ç—É –Ω–µ –≤–∑–µ–ª–∞ –±—ã. –° –º–æ—à–∏–Ω–æ–π –≤ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–µ —É–≤–∏–¥–µ—à—å —Ç–æ —á—Ç–æ —Å —è—Ö—Ç–æ—Ä–π –Ω–µ —É–≤–∏–¥–µ—à—å. –≠—Ç—É —Å—Ç—Ä–∞–Ω—É –Ω–∞–¥–æ –Ω–∞ –º–∞—à–∏–Ω–µ —Å–º–æ—Ç—Ä–µ—Ç—å. –û—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–∞—è —Å—Ç—Ä–∞–Ω–∞ –≥–¥–µ —Ç–æ—á–Ω–æ –Ω—É–∂–Ω–æ –ø–æ–±—ã–≤–∞—Ç—å</p>
            </div>
          </div>
        </div>
      </article>
    </main>
    <Footer/>
    </>
  );
};

export default StoryPage;
